{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Hotel Booking Email Parse Result",
    "description": "Structured output from hotel booking email parsing pipeline",
    "type": "object",
    "required": [
        "email_id",
        "intent",
        "segments",
        "metadata"
    ],
    "properties": {
        "email_id": {
            "type": "string",
            "description": "Unique identifier for the email"
        },
        "intent": {
            "type": "string",
            "enum": [
                "booking_request",
                "booking_modification",
                "cancellation",
                "price_inquiry",
                "availability_check",
                "other"
            ],
            "description": "Primary intent of the email"
        },
        "intent_confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence score for intent classification"
        },
        "segments": {
            "type": "array",
            "description": "Individual booking requests extracted from email",
            "items": {
                "$ref": "#/definitions/BookingSegment"
            }
        },
        "metadata": {
            "$ref": "#/definitions/Metadata"
        }
    },
    "definitions": {
        "BookingSegment": {
            "type": "object",
            "properties": {
                "segment_id": {
                    "type": "integer",
                    "description": "Sequential segment identifier"
                },
                "arrival_date": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "format": "date",
                    "description": "ISO 8601 date (YYYY-MM-DD)"
                },
                "departure_date": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "format": "date",
                    "description": "ISO 8601 date (YYYY-MM-DD)"
                },
                "nights": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "description": "Length of stay in nights"
                },
                "rooms": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Room"
                    }
                },
                "is_group_booking": {
                    "type": "boolean",
                    "description": "Whether this qualifies as a group booking per hotel config"
                },
                "hotel_name": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Hotel name if explicitly mentioned"
                },
                "confidence": {
                    "$ref": "#/definitions/ConfidenceScores"
                }
            }
        },
        "Room": {
            "type": "object",
            "properties": {
                "room_type": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Canonical room type (single, double, twin, suite, etc.)"
                },
                "adults": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "description": "Number of adult guests"
                },
                "children": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Child"
                    }
                },
                "total_guests": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "description": "Total occupancy for this room"
                }
            }
        },
        "Child": {
            "type": "object",
            "properties": {
                "age": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "description": "Age of child"
                }
            }
        },
        "ConfidenceScores": {
            "type": "object",
            "description": "Field-level confidence scores",
            "properties": {
                "arrival_date": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                },
                "departure_date": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                },
                "room_type": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                },
                "guest_count": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                }
            }
        },
        "Metadata": {
            "type": "object",
            "properties": {
                "processing_time_ms": {
                    "type": "number",
                    "description": "Total processing time in milliseconds"
                },
                "pipeline_version": {
                    "type": "string",
                    "description": "Version of the parsing pipeline"
                },
                "provenance": {
                    "type": "object",
                    "description": "Extraction method per field (rule-based vs ML)",
                    "properties": {
                        "intent": {
                            "type": "string",
                            "enum": [
                                "ml",
                                "rule",
                                "hybrid"
                            ]
                        },
                        "dates": {
                            "type": "string",
                            "enum": [
                                "ml",
                                "rule",
                                "hybrid"
                            ]
                        },
                        "entities": {
                            "type": "string",
                            "enum": [
                                "ml",
                                "rule",
                                "hybrid"
                            ]
                        }
                    }
                },
                "warnings": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Non-fatal warnings during processing"
                },
                "errors": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Errors encountered (empty if successful)"
                }
            }
        }
    }
}